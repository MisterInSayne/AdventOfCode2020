------------------- PART 1 -------------------
t←(⍎,⍞)
a←∊(⍎¨('x'(≠⊂⊢)¨(','(≠¨⊂⊢)⍞)))
b←{⍵-(⍵|t)} ¨a
⎕←(⌊/b)×(⊃⍋b)⌷a
------------------- PART 2 -------------------
F←{(a k b j o)←⍵⋄{((a)|(⍵+j))=(k+o):(⍵+j-o)⋄⍵∇⍵+b}b}⋄e←p←l←t←0
⎕←{r←⍵⋄{c←(⍵⌷r)⋄'x'=c:⍫⍬⋄⍵=0:⍫{p←c⋄t←c⋄l←0}⍵⋄e=0:⍫{e←F p 0 c 0 (⍵-l)⋄p←c⋄t←t×c⋄l←⍵⋄⍫e}⍵
⍫{n←F p 0 c 0 (⍵-l)⋄e←F t e (p×c) n l⋄p←c⋄l←⍵⋄t←t×c⋄⍫e}⍵}¨⍳⍴r} ∊{('x'=⊃⍵):⍫⍵⋄⍫⍎⍵}¨(','(≠⊂⊢)⍞)
